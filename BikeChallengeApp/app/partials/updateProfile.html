<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <style>
       
    </style>
</head>
<body>
       
        <div class="container" style="padding-top:30px">
            <div class="col-md-8 pull-right">
                <fieldset>
                    <legend>עריכת פרטי המשתמש</legend>
                </fieldset>

                

                <form name="personalDetails"  novalidate>
                    <!-- First Name-->
                    <label><small>שם פרטי</small></label>
                    <div class="form-group" ng-click="flipFlag('UserFname')" ng-if="!updateFlags.UserFname">
                        <input class="form-control"
                               value="{{currentDetails.UserFname}}" />
                    </div>
                    <div ng-if="updateFlags.UserFname">
                       
                        <label class="pull-left">
                            <button class="btn btn-success fa fa-save fa-1x"
                                    ng-disabled="personalDetails.UserFname.$invalid"
                                    ng-click="updateField('UserFname', personalDetails.UserFname)"></button>
                        </label>
                        <label class="pull-left">
                            <button class="btn btn-default fa fa-undo fa-1x"
                                    ng-click="flipFlag('UserFname')"></button>
                        </label>
                        <div class="form-group" ng-class="{ 'has-error' : personalDetails.UserFname.$invalid && personalDetails.UserFname.$dirty , 'has-success' : personalDetails.UserFname.$valid , 'has-required' : personalDetails.UserFname.$pristine}">
                            <input name="UserFname"
                                   type="text"
                                   class="form-control"
                                   ng-model="UserFname"
                                   placeholder="{{currentDetails.UserFname}}"
                                   data-tooltip="שם פרטי"
                                   data-tooltip-trigger="focus"
                                   data-tooltip-placement="right"
                                   required />
                        </div>
                    </div>
                        <!-- Last name -->
                    <label><small>שם משפחה</small></label>    
                    <div class="form-group" ng-click="flipFlag('UserLname')" ng-if="!updateFlags.UserLname">
                            <input class="form-control"
                                   value="{{currentDetails.UserLname}}" />
                        </div>

                        <div ng-if="updateFlags.UserLname">
                            
                            <label class="pull-left">
                                <button class="btn btn-success fa fa-save fa-1x"
                                        ng-disabled="personalDetails.UserLname.$invalid"
                                        ng-click="updateField('UserLname', personalDetails.UserLname)"></button>
                            </label>
                            <label class="pull-left">
                                <button class="btn btn-default fa fa-undo fa-1x"
                                        ng-click="flipFlag('UserLname')"></button>
                            </label>
                            <div class="form-group" ng-class="{ 'has-error' : personalDetails.UserLname.$invalid && personalDetails.UserLname.$dirty , 'has-success' : personalDetails.UserLname.$valid, 'has-required' : personalDetails.UserLname.$pristine }">
                                <input name="UserLname"
                                       type="text"
                                       class="form-control"
                                       ng-model="UserLname"
                                       data-tooltip="שם משפחה"
                                       data-tooltip-trigger="focus"
                                       data-tooltip-placement="right"
                                       required />
                            </div>
                        </div>
                        <!-- Email Address-->
                    <label><small>כתובת דואר אלקטרוני</small></label>
                        <div class="form-group" ng-click="flipFlag('email')" ng-if="!updateFlags.email">
                            <input class="form-control"
                                   value="{{currentDetails.email}}" />
                        </div>

                        <div ng-if="updateFlags.email">
                            
                            <label class="pull-left">
                                <button class="btn btn-success fa fa-save fa-1x"
                                        ng-disabled="personalDetails.email.$invalid"
                                        ng-click="updateField('email', personalDetails.email)"></button>
                            </label>
                            <label class="pull-left">
                                <button class="btn btn-default fa fa-undo fa-1x"
                                        ng-click="flipFlag('email')"></button>
                            </label>
                            <div class="form-group" ng-class="{ 'has-error' : personalDetails.email.$invalid && personalDetails.email.$dirty , 'has-success' : personalDetails.email.$valid, 'has-required' : personalDetails.email.$pristine }">
                                <input name="email"
                                       type="email"
                                       class="form-control"
                                       ng-model="email"
                                       data-email-validate
                                       data-tooltip="כתובת דואר אלקטרוני"
                                       data-tooltip-trigger="focus"
                                       data-tooltip-placement="right"
                                       required />
                                <p ng-show="personalDetails.email.$error.unique" class="help-block">כתובת הדואר האלקטרוני קיימת במערכת</p>
                            </div>
                        </div>


                        
                        <!-- Bike Type-->
                    <label ng-if="!updateFlags.BicycleType"><small>סוג האופניים</small></label>
                    <div ng-if="updateFlags.BicycleType" class="control-label">
                        <label class="pull-left">
                            <button class="btn btn-success fa fa-save fa-1x"
                                    ng-disabled="personalDetails.BicycleType.$invalid"
                                    ng-click="updateField('BicycleType', personalDetails.BicycleType)"></button>
                        </label>
                        <label class="pull-left">
                            <button class="btn btn-default fa fa-undo fa-1x"
                                    ng-click="flipFlag('BicycleType')"></button>
                        </label> 
                    </div>
                    
                    <div class="form-group" ng-click="flipFlag('BicycleType')" ng-if="!updateFlags.BicycleType">
                        <input class="form-control"
                               value="{{currentDetails.BicycleType}}" />
                    </div>
                    <div ng-if="updateFlags.BicycleType" id="bikeTypeCombo" class="form-group form-control" ng-class="{ 'has-success' : personalDetails.bikeType.$valid, 'has-required' : personalDetails.bikeType.$invalid}">
                        <label><small>סוג האופניים</small></label> &nbsp &nbsp &nbsp
                        <input class="form-control"
                               name="BicycleType"
                               type="radio"
                               data-icheck
                               ng-model="BicycleType"
                               value="הרים"
                               required />&nbsp הרים &nbsp &nbsp &nbsp
                        <input class="form-control"
                               name="BicycleType"
                               type="radio"
                               data-icheck
                               ng-model="BicycleType"
                               value="כביש"
                               required />&nbsp כביש &nbsp &nbsp &nbsp
                        <input class="form-control"
                               name="BicycleType"
                               type="radio"
                               data-icheck
                               ng-model="BicycleType"
                               value="חשמליים"
                               required />&nbsp חשמליים
                    </div>
                        <!-- Gender -->
                    <label ng-if="!updateFlags.Gender"><small>מין</small></label>
                    <div class="form-group" ng-click="flipFlag('Gender')" ng-if="!updateFlags.Gender">
                        <input class="form-control"
                               value="{{currentDetails.Gender}}" />
                    </div>
                    <div ng-if="updateFlags.Gender" class="control-label">
                        <label class="pull-left">
                            <button class="btn btn-success fa fa-save fa-1x"
                                    ng-disabled="personalDetails.Gender.$invalid"
                                    ng-click="updateField('Gender', personalDetails.Gender)"></button>
                        </label>
                        <label class="pull-left">
                            <button class="btn btn-default fa fa-undo fa-1x"
                                    ng-click="flipFlag('Gender')"></button>
                        </label>
                    </div>
                    <div id="genderCombo" ng-if="updateFlags.Gender" class="form-group form-control" ng-class="{ 'has-success' : personalDetails.gender.$valid, 'has-required' : personalDetails.gender.$invalid}">
                        <label><small>מין</small></label> &nbsp &nbsp &nbsp
                        <input name="Gender"
                               type="radio"
                               data-icheck ng-model="Gender"
                               value="M"
                               required />&nbsp זכר &nbsp &nbsp &nbsp
                        <input name="Gender"
                               type="radio"
                               data-icheck
                               ng-model="Gender"
                               value="F"
                               required />&nbsp נקבה
                    </div>
                        
                    
                   
                    
                    <!-- Birth Date -->
                        <label><small>תאריך לידה</small></label>
                    <div class="form-group" ng-click="flipFlag('BirthDate')" ng-if="!updateFlags.BirthDate">
                        <input class="form-control"
                               value="{{currentDetails.BirthDate}}" />
                    </div>
                    <div ng-if="updateFlags.BirthDate" class="form-group" ng-class="{  'has-success' : personalDetails.BirthDate.$valid, 'has-required' : personalDetails.BirthDate.$pristine }">
                        <label class="pull-left">
                            <button class="btn btn-success fa fa-save fa-1x"
                                    ng-disabled="personalDetails.BirthDate.$invalid"
                                    ng-click="updateField('BirthDate', personalDetails.BirthDate)"></button>
                        </label>
                        <label class="pull-left">
                            <button class="btn btn-default fa fa-undo fa-1x"
                                    ng-click="flipFlag('BirthDate')"></button>
                        </label>


                        <input name="BirthDate"
                               type="date"
                               class="form-control"
                               ng-model="BirthDate"
                               placeholder="{{currentDetails.BirthDate}}"
                               data-tooltip="תאריך לידה (יום-חודש-שנה)"
                               data-tooltip-trigger="focus"
                               data-tooltip-placement="right"
                               required />
                    </div>
                        <!-- Address - Street Name -->
                    <label><small>כתובת</small></label>    
                    <div class="form-group" ng-click="flipFlag('UserAddress')" ng-if="!updateFlags.UserAddress">
                        <input class="form-control"
                               value="{{currentDetails.UserAddress}}" />
                    </div>
                    
                    <div class="form-group" ng-if="updateFlags.UserAddress">
                        <label class="pull-left">
                            <button class="btn btn-success fa fa-save fa-1x"
                                    ng-disabled="personalDetails.UserAddress.$viewValue==undefined"
                                    ng-click="updateField('UserAddress', personalDetails.UserAddress)"></button>
                        </label>
                        <label class="pull-left">
                            <button class="btn btn-default fa fa-undo fa-1x"
                                    ng-click="flipFlag('UserAddress')"></button>
                        </label>
                        <input name="UserAddress"
                               type="text"
                               class="form-control"
                               ng-model="UserAddress"
                               data-tooltip="כתובת מגורים"
                               data-tooltip-trigger="focus"
                               data-tooltip-placement="right" />
                    </div>
                        
                    
                        <!-- Address - City Name -->
                        <label><small>עיר מגורים</small></label>
                    <div class="form-group" ng-click="flipFlag('City')" ng-if="!updateFlags.City">
                        <input class="form-control"
                               value="{{currentDetails.City}}"
                               />
                    </div>
                    <div ng-if="updateFlags.City" class="form-group" ng-class="{ 'has-error' : personalDetails.City.$invalid && !personalDetails.City.$pristine, 'has-required' : personalDetails.City.$pristine }">
                        <label class="pull-left">
                            <button class="btn btn-success fa fa-save fa-1x"
                                    ng-disabled="personalDetails.City.$invalid"
                                    ng-click="updateField('City', personalDetails.City)"></button>
                        </label>
                        <label class="pull-left">
                            <button class="btn btn-default fa fa-undo fa-1x"
                                    ng-click="flipFlag('City')"></button>
                        </label>
                        <select name="City"
                                id="citySelect"
                                class="form-control"
                                ng-model="City"
                                ng-options="c.CityName for c in citiesHolder"
                                data-tooltip="עיר מגורים"
                                data-tooltip-trigger="focus"
                                data-tooltip-placement="right"
                                required></select>
                    </div>
                        <!-- Phone Number -->
                        <label><small>מספר טלפון</small></label>
                    
                    <div class="form-group" ng-click="flipFlag('UserPhone')" ng-if="!updateFlags.UserPhone">
                        <input class="form-control"
                               value="{{currentDetails.UserPhone}}"
                               />
                    </div>
                    <div ng-if="updateFlags.UserPhone" class="form-group" ng-class="{'has-success' : personalDetails.UserPhone.$valid && !personalDetails.UserPhone.$pristine , 'has-error' : personalDetails.UserPhone.$invalid && !personalDetails.UserPhone.$pristine }">
                        <label class="pull-left">
                            <button class="btn btn-success fa fa-save fa-1x"
                                    ng-disabled="personalDetails.UserPhone.$invalid"
                                    ng-click="updateField('UserPhone', personalDetails.UserPhone)"></button>
                        </label>
                        <label class="pull-left">
                            <button class="btn btn-default fa fa-undo fa-1x"
                                    ng-click="flipFlag('RiderCity')"></button>
                        </label>
                        <input name="UserPhone"
                               type="tel"
                               class="form-control"
                               ng-model="phone"
                               ng-maxlength=10
                               ng-minlength=9
                               placeholder="{{currentDetails.UserPhone}}"
                               data-tooltip="מספר טלפון"
                               data-tooltip-trigger="focus"
                               data-tooltip-placement="right" />
                    </div>
                        <fieldset>
                            <legend>בחירת ארגון וקבוצה</legend>
                        </fieldset>
                        <!-- Organization-->
                    <span class="form-control" ng-if="!updateFlags.Organization" ng-click="flipFlag('Organization')"> <strong>הארגון הנוכחי הוא: </strong>{{currentDetails.OrganizationDes}}</span>
                    <div ng-if="updateFlags.Organization" class="form-group" ng-class="{'has-success' : personalDetails.org, 'has-required' : personalDetails.org == undefined || personalDetails.org == null}">
                        <label class="pull-left">
                            <button class="btn btn-success fa fa-save fa-1x"
                                    ng-disabled="(personalDetails.org == null || personalDetails.team.$invalid)"
                                    ng-click="updateField('Organization', personalDetails.org, personalDetails.team.$viewValue.GroupName)"></button>
                        </label>
                        <label class="pull-left">
                            <button class="btn btn-default fa fa-undo fa-1x"
                                    ng-click="flipFlag('Organization')"></button>
                        </label>
                        <a class="btn btn-default"
                           ng-click="getOrgs()"
                           data-toggle="modal"
                           data-target="#myModal">
                            <span class="glyphicon glyphicon-search"></span>&nbspבחר ארגון
                        </a>
                        <a class="btn btn-default" ng-click="" data-toggle="modal" data-target="#myNewOrgModal"><span class="glyphicon glyphicon-plus"></span>&nbspיצירת ארגון חדש</a>
                        <a class="btn btn-default" ng-click="clearSelection()"><span class="glyphicon glyphicon-remove"></span>&nbspנקה בחירה</a>
                        <br /><br />
                        <span class="form-control" ng-if="personalDetails.org"> <strong>הארגון שנבחר הוא: </strong>{{personalDetails.org}}</span>
                        <span class="form-control" ng-if="!personalDetails.org"> <strong> טרם נבחר ארגון </strong>{{personalDetails.org}}</span>
                    </div>
                        <!-- Group-->
                    <div class="form-group" ng-if="updateFlags.Organization">
                        <div ng-if="personalDetails.org">
                            <label><small>קבוצה</small></label>
                            <select class="form-control" name="team" id="teamSelect" ng-model="GroupDes" ng-options="t.GroupDes for t in teamPerOrg" required> </select>
                            <br />
                            <a class="btn btn-default" data-toggle="modal" data-target="#myNewTeamModal"><span class="glyphicon glyphicon-plus"></span>&nbspיצירת קבוצה חדשה</a>
                        </div>
                    </div>
                    <br />
                    <div class="form-group" ng-if="currentDetails.Captain">
                        <label><small>העברת דגל הקפטן</small></label>
                        <label class="pull-left">
                            <button class="btn btn-success fa fa-save fa-1x"
                                    ng-disabled="personalDetails.BicycleType.$invalid"
                                    ng-click="replaceCaptain(newCaptain)"></button>
                        </label>
                            <select class="form-control" name="team" id="captainSelect" ng-model="newCaptain" ng-options="u.UserName for u in groupMembers" required> </select>
                    </div> 
                      
        </form>
                

            </div>
            <div class="col-md-4 ">
                <div class="row" style="max-width:200px; height:200px">
                    <img src='{{currentDetails.ImagePath}}' class="img-rounded img-responsive" ng-click="flipFlag('ImagePath')"/>
                    <!-- Profile Image-->
                    <div class="form-group"
                         ng-if="updateFlags.ImagePath"
                         >
                        <label><small>תמונת פרופיל</small></label>
                        <input type="file"
                               ng-file-select="onFileSelect($files)"
                               class="form-control"
                               ng-model="imagePath"
                               ng-class="{'has-success' : personalDetails.imagePath != undefined}"
                               placeholder="תמונה" />
                    </div>
                </div>

                <div class="row">

                </div>

            </div>
        </div>


    <!-- Organization Picker Modal Window  -->

    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <span class="modal-title" id="myModalLabel">בחר ארגון</span>
                    <div class="pull-left">
                        <button type="button" class="btn btn-default" data-dismiss="modal">ביטול</button>
                        <button type="button" class="btn btn-primary" ng-click="myOrg(orgSelection)">שמור</button>
                    </div>
                </div>
                <div class="modal-body row">
                    <div class="row">
                        <div class="col-md-5 pull-right">
                            <div class="form-control">
                                <input class="pull-right" ng-model="query" style="border:none" />
                                <span class="glyphicon glyphicon-search pull-left"></span>
                            </div>
                        </div>
                        <div class="col-md-7">
                            
                            <span><i class="glyphicon glyphicon-info-sign" style="color:blue">&nbsp;</i><small>לא מצאת את הארגון שלך?, סגור את החלונית ובחר "יצירת ארגון חדש"</small></span>
                        </div>
                    </div>
                    
                    <hr />
                    <br />
                    <div ng-repeat="org in orgs | filter:query">
                        <div class="col-md-6">
                            <input type="radio" data-icheck name=radio2 class="col-md-1" value={{org.OrganizationDes}} ng-model="$parent.orgSelection" />
                            <div class="col-md-11">
                                <div class="panel panel-primary ">
                                    <div class="panel-heading">
                                        <span>{{org.OrganizationDes}},</span>
                                        <span><small>{{org.OrganizationType}}</small></span>
                                        <span><small>( {{org.CityName}} )</small></span>
                                    </div>
                                    <div class="panel-body">
                                        <img src="{{org.OrganiztionImage}}" class="img-rounded img-responsive" style="height:70px">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                   
                </div>
            </div>
        </div>
    </div>

    <!-- Organization Creator Modal Window  -->
    <div class="modal fade" id="myNewOrgModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myNewOrgModalLabel">יצירת ארגון חדש</h4>
                </div>
                <div class="modal-body row">
                    <br />

                    <input type="text" class="form-control" ng-model="newOrg.OrganizationName" placeholder="שם הארגון" required /><br />
                    <label><strong>עיר</strong></label>
                    <select id="citySelect" class="form-control" ng-model="newOrg.OrganizationCity" ng-options="c.CityName for c in citiesHolder" required> </select>
                    <br />
                    <!--<input type="text" class="form-control" ng-model="newOrg.OrganizationDes" placeholder="תיאור הארגון" required /><br />-->
                    <input type="text" class="form-control" ng-model="newOrg.OrganizationType" placeholder="אופי הארגון (תעשייה, חברת תוכנה, מכללה, וכו'...')" required />
                    <br />
                    <label><strong>לוגו הארגון</strong></label>
                    <input type="file" class="form-control" ng-file-select="onFileSelectOrg($files)" ng-model="newOrg.imagePath" placeholder="תמונה" required /><br />


                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">ביטול</button>
                    <button type="submit" class="btn btn-primary" ng-disabled="!newOrg.OrganizationName" ng-click="regNewOrg(newOrg)">שמור</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Team Creator Modal Window  -->
    <div class="modal fade" id="myNewTeamModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myNewTeamModalLabel">יצירת קבוצה חדשה</h4>
                </div>
                <div class="modal-body row">
                    <br />
                    <input type="text" class="form-control" ng-model="newTeam.GroupName" placeholder="שם הקבוצה" required /><br />
                    <input type="text" class="form-control" ng-model="newTeam.GroupDes" placeholder="תיאור הקבוצה" required /><br />
                    <!-- Org name is taken from personalDetails.org-->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">ביטול</button>
                    <button type="submit" class="btn btn-primary" ng-click="regNewTeam(newTeam, $scope.$$childHead.personalDetails.org)">שמור</button>
                </div>
            </div>
        </div>
    </div>
   
</body>
</html>


